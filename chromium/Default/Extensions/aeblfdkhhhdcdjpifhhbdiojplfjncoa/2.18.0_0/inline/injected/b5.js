(function () {
	'use strict';

	const e=()=>function(){if("undefined"!=typeof window)return window;if("undefined"!=typeof globalThis)return globalThis;throw new Error("unable to locate global object")}().crypto.getRandomValues(new Uint32Array(1))[0].toString(36);class t{constructor(e=""){this.log=(e,...t)=>{this.isPermitted()&&this.message(e);},this.debug=(e,...t)=>{this.isPermitted()&&this.message(e);},this.info=(e,...t)=>{this.isPermitted()&&console.info(this.message(e),...t);},this.warn=(e,...t)=>{this.isPermitted()&&console.warn(this.message(e),...t);},this.error=(e,...t)=>{this.isPermitted()&&console.error(this.message(e),...t);},this.isPermitted=()=>!1,this.message=e=>this._prependMessage?`${this._prependMessage}: ${e}`:e,this._prependMessage=e;}}class n{constructor(){this.request=e=>new Promise(((t,n)=>{chrome.runtime.sendMessage(e,(s=>{"Success"===s.type?t(s.data):n(new Error(`Error response received for message <${e.name}>`));}));})),this.on=(e,n)=>{function s(s,i,o){if(s.name&&s.name===e){const e=new t("WebExtListener handler registration");return new Promise((e=>e(n(s.data)))).then(o).catch((t=>{console.warn(`Caught error handling <${s.name}> message`),e.error(t);})),!0}return !1}return chrome.runtime.onMessage.addListener(s),s},this.off=(e,t)=>{chrome.runtime.onMessage.removeListener(t);};}}class s{constructor(){this.uuid=e(),this.callbacks={},this.request=e=>new Promise((t=>{const n=s.generateId();this.callbacks[n]=t,this._sendMessage(Object.assign({callbackId:n},e));})),this.on=(e,t)=>this._register((n=>{n.name&&n.name===e&&Promise.resolve(t(n.data)).then((e=>{this._sendMessage(Object.assign(Object.assign({},n),{data:e}));}));})),this.off=(e,t)=>{this._deregister(e,t);},this.listenForResponses=()=>{this._register((e=>{"callbackId"in e&&e.callbackId in this.callbacks&&(this.callbacks[e.callbackId](e.data),delete this.callbacks[e.callbackId]);}));},this._sendMessage.bind(this),this._register.bind(this),this._deregister.bind(this),this.listenForResponses();}}s.generateId=()=>window.crypto.getRandomValues(new Uint32Array(1))[0];class i extends s{_sendMessage(e){}_register(e){var t;function n(e){e.data.outgoing;}return null===(t=window.top)||void 0===t||t.addEventListener("message",n),n}_deregister(e,t){}}class o extends s{static isSafariAppExtension(){return "undefined"!=typeof safari&&void 0!==safari.extension}_sendMessage(e){const t={callbackId:e.callbackId,uuid:this.uuid,outgoing:!0,frameOrigin:window.location.origin,message:{name:e.name,data:e.data}};safari.extension.dispatchMessage("message",t);}_register(e){const t=this.uuid;function n(n){const s=n.message;!s||s.uuid&&s.uuid!==t||e({callbackId:s.callbackId,name:s.message.name,data:s.message.data});}return safari.self.addEventListener("message",n),n}_deregister(e,t){safari.self.removeEventListener("message",t);}}const a="undefined"!=typeof chrome&&void 0!==chrome.runtime&&void 0!==chrome.runtime.sendMessage&&void 0!==chrome.runtime.onMessage?new n:o.isSafariAppExtension()?new o:new i,r={"auto-sign-in-to-b5":function(e){if(!d())return;document.dispatchEvent(new CustomEvent("B5InitializeSession",{detail:h(e)}));},"initialize-device":function(e){if(!d())return;document.dispatchEvent(new CustomEvent("B5InitializeDevice",{detail:h(e.device)}));},lock:()=>{},"display-mfa-required":function(e){if(!d())return;let t;const n=new MutationObserver((()=>{var s,i;if(null===(i=null===(s=document.getElementById("signin-form"))||void 0===s?void 0:s.firstElementChild)||void 0===i?void 0:i.classList.contains("two-factor-entry"))null==t||t.remove(),n.disconnect();else {const n=document.getElementsByClassName("existing-signin")[0];n&&0===document.getElementsByClassName("lock-message").length&&(t=document.createElement("div"),t.classList.add("lock-message","box","red"),t.textContent=e.content,n.insertBefore(t,n.firstChild));}}));n.observe(document.body,{childList:!0,subtree:!0});},"request-delegated-session":function(e){return d()?new Promise((t=>{document.addEventListener("B5RequestDelegatedSessionResponse",(e=>{t(e.detail);}),{once:!0}),document.dispatchEvent(new CustomEvent("B5RequestDelegatedSession",{detail:h(e)}));})):Promise.resolve(void 0)}};for(const e in r)a.on(e,r[e]);function d(){let e=window.location.hostname;if(!e)return !1;e=e.toLowerCase();const t=["1password.ca","1password.com","1password.eu","b5dev.ca","b5dev.com","b5dev.eu","b5local.com","b5staging.com","b5test.ca","b5test.com","b5test.eu","b5rev.com"];for(const n of t)if(e===n||e.endsWith("."+n))return !0;return !1}function c(e){const t=document.querySelector(`iframe[src="${e}"]`);t&&document.body.removeChild(t);}function u(e){!function(e,t){const n=document.createElement("iframe");n.id=e,t&&(n.src=t);document.body.appendChild(n);}("b5x-notification",e);}const l={B5WebReady:function(e){if(!d())return;const t=e.detail;if(!t.capabilities.DeviceInit)return;a.request({name:"b5Ready",data:{deviceInit:t.capabilities.DeviceInit,sessionInit:t.capabilities.SessionInit}});},B5SignInSucceeded:m,B5DelegatedSignInSucceeded:m,"share-save-item":function(e){if(!d())return;a.request({name:"share-save-item",data:e.detail.itemJson});},"open-extension-welcome-page":function(e){var t,n;if(!d())return;a.request({name:"open-extension-welcome-page-for-onboarding",data:{owner:null===(t=null==e?void 0:e.detail)||void 0===t?void 0:t.owner,accountType:null===(n=null==e?void 0:e.detail)||void 0===n?void 0:n.accountType}});}};function m(e){if(d()){if("B5SignInSucceeded"===e.type){const t=e.detail;t.signinAddress=window.location.origin;const n={name:"sign-in-succeeded",data:{type:e.type,details:t}};a.request(n);}else {if("B5DelegatedSignInSucceeded"!==e.type)throw new Error("Unexpected event sent to handleUntrustedSignInEvent");{const t=e.detail;t.signinAddress=window.location.origin;const n={name:"sign-in-succeeded",data:{type:e.type,details:t}};a.request(n);}}a.on("show-add-account-prompt",u),a.on("close-add-account-prompt",c);}}for(const e in l)document.addEventListener(e,l[e]);function g(){document.dispatchEvent(new CustomEvent("B5OPXReady",{bubbles:!1,cancelable:!1,detail:h({capabilities:{CustomAutosave:!0,SessionInit:1,DeviceInit:1,SingleSignOn:1,DelegatedSession:0,ShareSrpX:1}})}));}function h(e){return "function"==typeof cloneInto?cloneInto(e,window.document):e}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g(),a.request({name:"get-build-number",data:{}}).then((e=>{e.setOldAttribute&&(document.body.dataset.onepasswordExtensionVersion=e.buildNumber),document.body.dataset.b5xBuildNumber=e.buildNumber;}));

})();
